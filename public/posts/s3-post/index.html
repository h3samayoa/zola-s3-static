<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         s3 static website with zola
        
    </title><meta content="s3 static website with zola" property=og:title><link href=/icon/favicon.png rel=icon type=image/png><link href=http://vainfaith.s3-website-us-west-1.amazonaws.com/fonts.css rel=stylesheet><link href=http://vainfaith.s3-website-us-west-1.amazonaws.com/atom.xml rel=alternate title=vain type=application/atom+xml><link href=http://vainfaith.s3-website-us-west-1.amazonaws.com/theme/light.css rel=stylesheet><link href=http://vainfaith.s3-website-us-west-1.amazonaws.com/theme/dark.css id=darkModeStyle rel=stylesheet><link href=http://vainfaith.s3-website-us-west-1.amazonaws.com/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com>vain</a><div class=socials><a class=social href=https://twitter.com/fwvain rel=me> <img alt=twitter src=/social_icons/twitter.svg> </a><a class=social href=https://github.com/h3samayoa/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=/posts style=margin-left:.7em>/posts</a><a href=/projects style=margin-left:.7em>/projects</a><a href=/about style=margin-left:.7em>/about</a></nav><nav>| <a href id=dark-mode-toggle onclick=toggleTheme()> <img height=15 id=sun-icon src=feather/sun.svg style=border:unset;filter:invert(1);display:none> <img height=15 id=moon-icon src=feather/moon.svg style=border:unset;display:none> </a><script src=http://vainfaith.s3-website-us-west-1.amazonaws.com/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>s3 static website with zola<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2023-09-28</time></div></div><h1>Table of Contents</h1><ul><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#wtf-is-zola>wtf is zola</a> <ul><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#install-zola>install zola</a></ul><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#aws-stuff>aws stuff</a> <ul><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#iam-policy>iam-policy</a><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#bucket-policy>bucket-policy</a></ul><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#gh-actions>gh actions</a> <ul><li><a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#gh-workflow>gh-workflow</a></ul></ul><section class=body><h1 id=wtf-is-zola>wtf is zola</h1><p><a href=https://www.getzola.org/>zola</a> is a single-executable application wriiten in rust. it integrates a wide array of features inlcuding sass compilation and syntax highlighting, to streamline development. the content of the website is authored in <a href=https://commonmark.org/>common mark</a>, a universally compatible markdown specification.<h2 id=install-zola>install zola</h2><p>im currently running <a href=https://pop.system76.com/>pop_os</a> 22.04 LTS and since i do not use flatpak or snap i have to unpack the debian package from their <a href=https://github.com/barnumbirr/zola-debian>gh page</a>. this is pretty easy just visit the page and install the release that matches your systems architecture. i installed the bullseye v0.17.2-1 package and unpacked it by running <code>sudo dpkg -i zola_0.17.2-1_amd64_bullseye.deb</code> and now i can run the <code>zola</code> cmd on my machine anywhere. <code>zola init</code> will populate the current directory if it is empty with the exclusion of hidden files or <code>zola init &LTyour-dir></code> will populate the specified directory only if the directory is empty. (the --force flag can be passed to both cmds to populate the directory despite the files)<h1 id=aws-stuff>aws stuff</h1><p>an s3 bucket can be made directly from the console but the <a href=https://aws.amazon.com/cli/>aws cli</a> can create and configure an s3 bucket for static website hosting. the <a href=https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3/mb.html>s3 mb</a> cmd will create a new bucket <code>aws s3 mb s3://&LTbucket-name></code>. in the aws console go to the newly created s3 bucket and in the properties tab enable static website hosting. make sure to point to the index.html file. go to the permissions tab and disable 'block all public access'. in the 'bucket policy' tab add <a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#bucket-policy>bucket-policy</a> which allows access to the buckets resources or else your pages will return a 403. go to iam > policies and in JSON create a <a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#iam-policy>new iam policy</a> with your bucket name in the resources. then go to iam > users and create a new user with the attached policy for its permissions. select 'create access key' and choose cli for its permissions.<h2 id=iam-policy>iam-policy</h2><pre style=background:#0f1419;color:#bfbab0><code><span>{
</span><span>    "Version": "2012-10-17",
</span><span>	"Statement": [{
</span><span>		"Sid": "AccessToWebsiteBuckets",
</span><span>		"Effect": "Allow",
</span><span>		"Action": [
</span><span>            "s3:PutBucketWebsite",
</span><span>			"s3:PutObject",
</span><span>			"s3:PutObjectAcl",
</span><span>			"s3:GetObject",
</span><span>			"s3:ListBucket",
</span><span>			"s3:DeleteObject"
</span><span>		],
</span><span>		"Resource": [
</span><span>			"arn:aws:s3:::Bucket-Name",
</span><span>			"arn:aws:s3:::Bucket-Name/*"
</span><span>		]    
</span><span>    }]
</span><span>}
</span></code></pre><h2 id=bucket-policy>bucket-policy</h2><pre style=background:#0f1419;color:#bfbab0><code><span>{
</span><span>    "Version": "2012-10-17",
</span><span>    "Statement": [
</span><span>        {
</span><span>            "Sid": "AddPerm",
</span><span>            "Effect": "Allow",
</span><span>            "Principal": "*",
</span><span>            "Action": "s3:GetObject",
</span><span>            "Resource": "arn:aws:s3:::Bucket-Name/*"
</span><span>        }
</span><span>    ]
</span><span>}
</span></code></pre><h1 id=gh-actions>gh actions</h1><p>i use gh actions so i can manic post quicker with automatic deployments on merges to main. we need to set our repo secrets which is in the settings tab under the 'secrets and variables' dropdown. select 'actions' and 'new repository secret'. add <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> using the keys we obtained from the previously created iam user. add <code>S3_BUCKET</code> with your bucket name as the value and finally add <code>AWS_DEFAULT_REGION</code> with the region your bucket is in. we now need to setup a new action <a href=http://vainfaith.s3-website-us-west-1.amazonaws.com/posts/s3-post/#gh-workflow>workflow</a> this workflow checks-out your repository, uses an <a href=https://github.com/taiki-e/install-action>action</a> to install zola, runs the <code>zola build</code> cmd to build the 'public/' directory, and uses another <a href=https://github.com/Reggionick/s3-deploy>action</a> that utilizes the secrets we created earlier to deploy the public directory to our s3 bucket which will now be hosting our static website!<h2 id=gh-workflow>gh-workflow</h2><pre style=background:#0f1419;color:#bfbab0><code><span>name: Build and Publish to AWS
</span><span>on:
</span><span>  push:
</span><span>    branches:
</span><span>      - main
</span><span>jobs:
</span><span>  run:
</span><span>    runs-on: ubuntu-latest
</span><span>    timeout-minutes: 10
</span><span>    steps:
</span><span>      - name: checkout repo
</span><span>        uses: actions/checkout@v4
</span><span>        
</span><span>      - name: install zola
</span><span>        uses: taiki-e/install-action@v2.18.15
</span><span>        with:
</span><span>          tool: zola@0.17.2
</span><span>          
</span><span>      - name: Build
</span><span>        run: zola build
</span><span>        
</span><span>      - name: deploy to s3 bucket
</span><span>        uses: reggionick/s3-deploy@v4
</span><span>        env:
</span><span>          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
</span><span>          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
</span><span>        with:
</span><span>          folder: public
</span><span>          bucket: ${{ secrets.S3_BUCKET }}
</span><span>          private: true
</span><span>          bucket-region: ${{ secrets.AWS_DEFAULT_REGION }}
</span></code></pre></section></article></main></div>